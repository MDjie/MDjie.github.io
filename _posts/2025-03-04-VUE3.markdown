---
layout: post
title: "Learning records for VUE3"
date: 2025-04-03 11:09:10 +0800
category: jekyll update
---
# VUE3
## basic grammar
***
VUEä¸­æœ€åŸºç¡€çš„å°±æ˜¯vueæŒ‡ä»¤ï¼ŒæŒ‡ä»¤æ—¶ä¸€ç§ä»¥v-å¼€å¤´çš„ç‰¹æ®Šè¡¨è¾¾å¼ï¼Œé™¤äº†***v-on,v-slot,v-for***å¤–ï¼Œæ‰€æœ‰æŒ‡ä»¤éƒ½æœŸæœ›ä¸€ä¸ªè¡¨è¾¾å¼ä½œä¸ºè¾“å…¥ã€‚ä¸€ä¸ªæŒ‡ä»¤çš„ä»»åŠ¡å°±æ˜¯åœ¨è¾“å…¥æ”¹å˜æ—¶ï¼Œåœ¨***domæ–‡æ¡£ä¸­è¿›è¡Œæ›´æ–°***
ã€‚æŒ‡ä»¤çš„ç»“æ„ä¸º
![è¡¨è¾¾å¼ç»“æ„](../assets/VUE3-struction-architecture.png)
***
### æ–‡å­—æ’å€¼ä¸htmlæ’å…¥
***
`{{virable}}`could dynamically insert the content of variable into the page.`v-html="virable"` could parse variable as a html element and show it in the page.
***
### å±æ€§ç»‘å®š
***
`<div v-bind:id="dynamicId"></div>`will bind a dynamic value to the div's id attribute. it's shorthand syntax is `<div :id="dynamicId"></div>`. if the variable's name is same as the attribute, then the syntax could
be more easier:`<div :id></div>`,same as :id="id".This feature is supported only in 3,4+.
æ‰€æœ‰çš„æ•°æ®ç»‘å®šä¸­éƒ½æ”¯æŒå®Œæ•´çš„ JavaScript è¡¨è¾¾å¼ï¼Œä¹Ÿå¯ä»¥åœ¨ç»‘å®šçš„è¡¨è¾¾å¼ä¸­ä½¿ç”¨ä¸€ä¸ªç»„ä»¶æš´éœ²çš„æ–¹æ³•å¦‚ï¼š
```
<time :title="toTitleDate(date)" :datetime="date">
  {{ formatDate(date) }}
</time>
```
è¡¨è¾¾å¼ä¸­ä»…èƒ½ä½¿ç”¨æœ‰é™çš„å…¨å±€å¯¹è±¡åˆ—è¡¨ï¼Œè¯¥åˆ—è¡¨ä¸­ä¼šæš´éœ²å¸¸ç”¨çš„å†…ç½®å…¨å±€å¯¹è±¡ï¼Œæ¯”å¦‚ Math å’Œ Dateã€‚æ²¡æœ‰æ˜¾å¼åŒ…å«åœ¨åˆ—è¡¨ä¸­çš„å…¨å±€å¯¹è±¡å°†ä¸èƒ½åœ¨æ¨¡æ¿å†…è¡¨è¾¾å¼ä¸­è®¿é—®ï¼Œä¾‹å¦‚ç”¨æˆ·é™„åŠ åœ¨ window ä¸Šçš„å±æ€§ã€‚
***
### åŠ¨æ€å‚æ•°
***
`<a :[attributeName]="url"> ... </a>` è¿™é‡Œçš„ attributeName ä¼šä½œä¸ºä¸€ä¸ª JavaScript è¡¨è¾¾å¼è¢«åŠ¨æ€æ‰§è¡Œï¼Œè®¡ç®—å¾—åˆ°çš„å€¼ä¼šè¢«ç”¨ä½œæœ€ç»ˆçš„å‚æ•°ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœä½ çš„ç»„ä»¶å®ä¾‹æœ‰ä¸€ä¸ªæ•°æ®å±æ€§ attributeNameï¼Œå…¶å€¼ä¸º "href"ï¼Œé‚£ä¹ˆè¿™ä¸ªç»‘å®šå°±ç­‰ä»·äº v-bind:hrefã€‚
åŠ¨æ€å‚æ•°ä¸­è¡¨è¾¾å¼çš„å€¼åº”å½“æ˜¯ä¸€ä¸ª***å­—ç¬¦ä¸²ï¼Œæˆ–è€…æ˜¯ null***ã€‚ç‰¹æ®Šå€¼ null æ„ä¸º***æ˜¾å¼ç§»é™¤è¯¥ç»‘å®š***ã€‚å…¶ä»–éå­—ç¬¦ä¸²çš„å€¼ä¼šè§¦å‘è­¦å‘Šã€‚
***
### ä¿®é¥°ç¬¦Modifiers
***
ç”¨æ¥è¡¨æ˜æŒ‡ä»¤çš„ç‰¹æ®Šæ‰§è¡Œæ–¹å¼ã€‚
***
### å“åº”å¼åŸºç¡€
#### ç”¨refå‡½æ•°å£°æ˜ä¸€ä¸ªå“åº”å¼å˜é‡
***
ref() æ¥æ”¶å‚æ•°ï¼Œå¹¶å°†å…¶åŒ…è£¹åœ¨ä¸€ä¸ªå¸¦æœ‰ .value å±æ€§çš„ ref å¯¹è±¡ä¸­è¿”å›ï¼š
```aiexclude
const count = ref(0)

console.log(count) // { value: 0 }
console.log(count.value) // 0
```
åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ï¼š
```aiexclude
<script>
import { ref } from 'vue'

export default {
  // `setup` æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„é’©å­ï¼Œä¸“é—¨ç”¨äºç»„åˆå¼ APIã€‚
  setup() {
    const count = ref(0)

    // å°† ref æš´éœ²ç»™æ¨¡æ¿
    return {
      count
    }
  }
}
</script>

<template>
<div>{{ count }}</div>
</template>
```

åœ¨ç»„ä»¶ä¸­ä½¿ç”¨å“åº”å¼å˜é‡æ—¶ï¼Œä¸ç”¨åŠ `.value`ã€‚å¯ä»¥ç›´æ¥åœ¨äº‹ä»¶ç›‘å¬å™¨ä¸­æ”¹å˜ä¸€ä¸ªrefçš„å€¼ã€‚
```aiexclude
<button @click="count++">
  {{ count }}
</button>
```
***
#### ç”¨reactiveæ¥åˆ›å»ºä¸€ä¸ªå“åº”å¼å˜é‡
***
```aiexclude

import { reactive } from 'vue'

const state = reactive({ count: 0 })
```
reactive() å°†ä½¿å¯¹è±¡æœ¬èº«å…·æœ‰å“åº”æ€§ã€‚

| ç‰¹æ€§            | ref             |reactive|
|---------------|-----------------|---|
| æ•°æ®ç±»å‹          | 	åªæ¥å—å¯¹è±¡/æ•°ç»„       |	æ¥å—ä»»ä½•ç±»å‹çš„å€¼|
| è®¿é—®æ–¹å¼	         | ç›´æ¥è®¿é—®å±æ€§	         | éœ€è¦é€šè¿‡ .value è®¿é—® |
| æ¨¡æ¿ä¸­ä½¿ç”¨         | 	ç›´æ¥ä½¿ç”¨           |	è‡ªåŠ¨è§£åŒ…(æ— éœ€ .value)|
| é‡æ–°èµ‹å€¼	         | ä¸èƒ½æ•´ä¸ªæ›¿æ¢(ä¼šå¤±å»å“åº”æ€§)	 | å¯ä»¥æ•´ä¸ªæ›¿æ¢(ä¿æŒå“åº”æ€§) |
| è§£æ„/å±•å¼€	        | ä¼šå¤±å»å“åº”æ€§          |	ä¿æŒå“åº”æ€§|
| TypeScriptæ”¯æŒ	 | ç±»å‹æ¨æ–­æ›´è‡ªç„¶         | 	éœ€è¦æ³›å‹å‚æ•°         |
***
#### å£°æ˜æ–¹æ³•
***
ç”¨functionå…³é”®è¯åœ¨`set up`å£°æ˜ä¸€ä¸ªæ–¹æ³•,å¹¶æš´éœ²ç»™æ¨¡æ¿ä»¥ä½¿ç”¨ã€‚
```aiexclude
import { ref } from 'vue'

export default {
  setup() {
    const count = ref(0)

    function increment() {
      // åœ¨ JavaScript ä¸­éœ€è¦ .value
      count.value++
    }

    // ä¸è¦å¿˜è®°åŒæ—¶æš´éœ² increment å‡½æ•°
    return {
      count,
      increment
    }
  }
}
```
å½“æœ‰å¾ˆå¤šå˜é‡ä¸æ–¹æ³•éœ€è¦æš´éœ²æ—¶ï¼Œå¯ä»¥ä½¿ç”¨`<script setup>...<script>`æ¥è‡ªåŠ¨æš´éœ²ç»™æ¨¡æ¿ã€‚å¦‚ï¼š
```aiexclude
<script setup>
import { ref } from 'vue'

const count = ref(0)

function increment() {
  count.value++
}
</script>

<template>
  <button @click="increment">
    {{ count }}
  </button>
</template>
```
VUEçš„å“åº”å…·æœ‰***æ·±å±‚æ¬¡***çš„ç‰¹æ€§ï¼Œå³åµŒå¥—ç±»å‹çš„æ·±å±‚è¢«ä¿®æ”¹æ—¶ï¼Œå¯¹åº”çš„æ¨¡æ¿ä¹Ÿèƒ½åŠ¨æ€åœ°å¾—åˆ°å“åº”ã€‚
***
### refçš„ä½¿ç”¨æ³¨æ„äº‹é¡¹
***
- ref ä½œä¸ºå“åº”å¼æ•°ç»„æˆ–åŸç”Ÿé›†åˆç±»å‹ (å¦‚ Map) ä¸­çš„å…ƒç´ è¢«è®¿é—®æ—¶ï¼Œå®ƒä¸ä¼šè¢«è§£åŒ…
```aiexclude
const books = reactive([ref('Vue 3 Guide')])
// è¿™é‡Œéœ€è¦ .value
console.log(books[0].value)

const map = reactive(new Map([['count', ref(0)]]))
// è¿™é‡Œéœ€è¦ .value
console.log(map.get('count').value)
```
- åœ¨æ¨¡æ¿æ¸²æŸ“ä¸Šä¸‹æ–‡ä¸­ï¼Œåªæœ‰é¡¶çº§çš„ ref å±æ€§æ‰ä¼šè¢«è§£åŒ…ã€‚

åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œcount å’Œ object æ˜¯é¡¶çº§å±æ€§ï¼Œä½† object.id ä¸æ˜¯
```aiexclude
const count = ref(0)
const object = { id: ref(1) }
```
å› æ­¤ï¼Œè¿™ä¸ªè¡¨è¾¾å¼æŒ‰é¢„æœŸå·¥ä½œï¼š
```aiexclude
{{ count + 1 }}
```
...ä½†è¿™ä¸ªä¸ä¼šï¼š
```aiexclude
{{ object.id + 1 }}
```
- å¦‚æœ ref æ˜¯æ–‡æœ¬æ’å€¼çš„æœ€ç»ˆè®¡ç®—å€¼ (å³ {{ }} æ ‡ç­¾)ï¼Œé‚£ä¹ˆå®ƒå°†è¢«è§£åŒ…ã€‚
```aiexclude
{{ object.id }}
```
ä»¥ä¸Šéé¡¶å±‚å±æ€§ä¹Ÿèƒ½æ­£å¸¸å·¥ä½œã€‚
***
### è®¡ç®—å±æ€§
***
é¡¾åæ€ä¹‰ï¼Œè®¡ç®—å±æ€§å°±æ˜¯é€šè¿‡è®¡ç®—å¾—åˆ°çš„ä¸€ä¸ªå±æ€§ã€‚å¯¹äºç®€å•çš„è®¡ç®—ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡è¡¨è¾¾å¼çš„æ–¹å¼æ¥è·å¾—ï¼š`<span>{{ author.books.length > 0 ? 'Yes' : 'No' }}</span>`
è¿™æ ·åšå¯¹äºä¸€æ¬¡æ€§çš„è®¡ç®—ï¼Œç¡®å®å¾ˆæ–¹ä¾¿ã€‚ä½†æ˜¯å¦‚æœæ¨¡æ¿ä¸­æœ‰å¤šä¸ªåœ°æ–¹éœ€è¦ç”¨åˆ°åŒæ ·çš„è®¡ç®—åçš„ç»“æœï¼Œç»§ç»­ä½¿ç”¨è¡¨è¾¾å¼çš„æ–¹å¼ï¼Œå°±ä¸å¾—ä¸åœ¨æ¯ä¸ªéœ€è¦çš„åœ°æ–¹å†™ä¸€æ¬¡è¡¨è¾¾å¼ã€‚
å¯¹äºè¿™ç§æƒ…å†µã€‚å¯ä»¥ä½¿ç”¨è®¡ç®—å±æ€§æ¥ä»£æ›¿ï¼š
```aiexclude
const publishedBooksMessage = computed(() => {
  return author.books.length > 0 ? 'Yes' : 'No'
})

<template>
  <p>Has published books:</p>
  <span>{{ publishedBooksMessage }}</span>
</template>
```
è‡³æ­¤ï¼Œå…¶å®ä¹Ÿå¯ä»¥é€šè¿‡ä¸€ä¸ªæ–¹æ³•æ¥è¾¾åˆ°ç›¸åº”çš„æ•ˆæœï¼š
```aiexclude
fucntion comput(){
return author.books.length>0?'Yes':'No'
}
```
æ–¹æ³•ä¸è®¡ç®—å±æ€§æœ‰ä¸€é‡è¦åŒºåˆ«ï¼šè®¡ç®—å±æ€§æ˜¯***æœ‰ç¼“å­˜çš„***ã€‚æ–¹æ³•çš„è§¦å‘æ–¹å¼ä¸ºè°ƒç”¨ï¼Œè®¡ç®—å±æ€§çš„è§¦å‘æ–¹å¼ä¸ºå€¼çš„æ›´æ–°ï¼Œä¸”è®¡ç®—å±æ€§èƒ½åŸºäºå“åº”å¼ä¾èµ–è¢«ç¼“å­˜ã€‚æ‰€ä»¥åªè¦booksä¸å˜ï¼Œæ— è®ºå¤šå°‘æ¬¡è®¿é—®publishedBooksMessage ï¼Œéƒ½ä¼šç«‹å³è¿”å›ç¼“å­˜çš„å€¼ã€‚
è®¡ç®—å±æ€§è¿˜æ˜¯å¯å†™çš„ï¼Œè¿™ç‚¹ä¸å¸¸ç”¨åˆ°ï¼Œä¾¿ä¸è¿‡å¤šä»‹ç»äº†ã€‚
***getterä¸­è¿˜å¯ä»¥è·å–åˆ°ä¸Šä¸€æ¬¡çš„å€¼***ã€‚
***
### ç±»ä¸æ ·å¼çš„ç»‘å®š
#### ç±»çš„ç»‘å®š
***
`<div :class={active:isActive}><div>`ä¼ å…¥ä¸€ä¸ªå¯¹è±¡æ¥åŠ¨æ€æ¸²æŸ“ç±»åï¼Œå½“isActiveä¸ºtrueæ—¶ï¼Œactiveæ‰è¢«åŠ å…¥classçš„å€¼ä¸­ã€‚å¯ä»¥æ‰©å±•åˆ°å¤šä¸ªå¯¹è±¡å±æ€§ï¼Œåœ¨å¯¹è±¡ä¸­ä½¿ç”¨è®¡ç®—å±æ€§
```aiexclude
const isActive = ref(true)
const error = ref(null)

const classObject = computed(() => ({
  active: isActive.value && !error.value,
  'text-danger': error.value && error.value.type === 'fatal'
}))

<div :class="classObject"></div>
```
***
#### æ ·å¼çš„ç»‘å®š
***
```aiexclude
const styleObject = reactive({
  color: 'red',
  fontSize: '30px'
})

<div :style="styleObject"></div>
```
åŒæ ·çš„ï¼Œå¦‚æœæ ·å¼å¯¹è±¡éœ€è¦æ›´å¤æ‚çš„é€»è¾‘ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è¿”å›æ ·å¼å¯¹è±¡çš„è®¡ç®—å±æ€§ã€‚
***
### æ¡ä»¶ï¼Œåˆ—è¡¨æ¸²æŸ“

æ¡ä»¶æ¸²æŸ“
***
```aiexclude
<h1 v-if="bool1&&bool2">Vue is awesome!</h1>
<h1 v-else-if=bool1&&!bool2>Oh no ğŸ˜¢</h1>
<h1 v-else>last one</h1>
```
æ¡ä»¶æ¸²æŸ“ä¹Ÿå¯ä»¥ç”¨åœ¨templateä¸Šã€‚v-showä¸v-ifå·®ä¸å¤šï¼Œä½†æ˜¯ä¸å¯ç”¨åœ¨templateä¸Šï¼Œå…¶ä¼šä¿®è¯¥displayå±æ€§å€¼ã€‚
***
åˆ—è¡¨æ¸²æŸ“

æ•°ç»„æ¸²æŸ“åˆ—è¡¨
***
```aiexclude
const items = ref([{ message: 'Foo' }, { message: 'Bar' }])

<li v-for="item in items">
  {{ item.message }}
</li>

```
åœ¨ v-for å—ä¸­å¯ä»¥å®Œæ•´åœ°è®¿é—®***çˆ¶ä½œç”¨åŸŸå†…çš„å±æ€§å’Œå˜é‡***ã€‚v-for ä¹Ÿæ”¯æŒä½¿ç”¨å¯é€‰çš„ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºå½“å‰é¡¹çš„***ä½ç½®ç´¢å¼•***ã€‚
***
å¯¹è±¡åˆ—è¡¨æ¸²æŸ“
***
```aiexclude
const myObject = reactive({
  title: 'How to do lists in Vue',
  author: 'Jane Doe',
  publishedAt: '2016-04-10'
})

<template>
<ul>
<li v-for="value in mobject")>
{{value}}
</li>
</ul>
//é€šè¿‡ç¬¬äºŒä¸ªå‚æ•°å¼•å…¥key
<ul>
<li v-for="(value,key) in mobject")>
{{value}}.{{key}}
</li>
</ul>
</template>
//åŒç†ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°å¼•å…¥index
```
***
èŒƒå›´å€¼è¿›è¡Œåˆ—è¡¨æ¸²æŸ“
***
```aiexclude
<span v-for="n in 10">{{ n }}</span>
```
v-for VS v-if

å®ƒä»¬åŒæ—¶å­˜åœ¨äºä¸€ä¸ªèŠ‚ç‚¹ä¸Šæ—¶ï¼Œv-if æ¯” v-for çš„ä¼˜å…ˆçº§æ›´é«˜ã€‚è¿™æ„å‘³ç€ v-if çš„æ¡ä»¶å°†æ— æ³•è®¿é—®åˆ° v-for ä½œç”¨åŸŸå†…å®šä¹‰çš„å˜é‡åˆ«åã€‚
```aiexclude
<!--
 è¿™ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œå› ä¸ºå±æ€§ todo æ­¤æ—¶
 æ²¡æœ‰åœ¨è¯¥å®ä¾‹ä¸Šå®šä¹‰
-->
<li v-for="todo in todos" v-if="!todo.isComplete">
  {{ todo.name }}
</li>
```
è§£å†³æ–¹æ³•ï¼šåœ¨å¤–å…ˆåŒ…è£…ä¸€å±‚`<template>`å†åœ¨å…¶ä¸Šä½¿ç”¨`v-for`å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ (è¿™ä¹Ÿæ›´åŠ æ˜æ˜¾æ˜“è¯»)

```aiexclude
<template v-for="todo in todos">
  <li v-if="!todo.isComplete">
    {{ todo.name }}
  </li>
</template>
```
***
æ ¹æ®æ•°ç»„çŠ¶æ€æ¸²æŸ“ï¼š
***
```aiexclude
<div v-for="item in items" :key="item.id">
  <!-- å†…å®¹ -->
</div>
```
key ç»‘å®šçš„å€¼æœŸæœ›æ˜¯ä¸€ä¸ªåŸºç¡€ç±»å‹çš„å€¼ï¼Œä¾‹å¦‚å­—ç¬¦ä¸²æˆ– number ç±»å‹ã€‚ä¸è¦ç”¨å¯¹è±¡ä½œä¸º v-for çš„ keyã€‚
***
### äº‹ä»¶å¤„ç†
***
`v-on:click.prevent="count++"`å¯ä»¥ç®€å•ç¼–å†™ä¸€ä¸ªç‚¹å‡»å“åº”é€»è¾‘ã€‚ä½†å“åº”é€»è¾‘å¤æ‚æ—¶ï¼Œéœ€è¦æ„é€ æ–¹æ³•æ¥å¤„ç†
```aiexclude
const name = ref('Vue.js')

function greet(event) {
  alert(`Hello ${name.value}!`)
  // `event` æ˜¯ DOM åŸç”Ÿäº‹ä»¶
  if (event) {
    alert(event.target.tagName)
  }
}

<!-- `greet` æ˜¯ä¸Šé¢å®šä¹‰è¿‡çš„æ–¹æ³•å -->
<button @click="greet">Greet</button>
```
æ–¹æ³•äº‹ä»¶å¤„ç†å™¨ä¼šè‡ªåŠ¨æ¥æ”¶åŸç”Ÿ DOM äº‹ä»¶å¹¶è§¦å‘æ‰§è¡Œã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡è¢«è§¦å‘äº‹ä»¶çš„ event.target è®¿é—®åˆ°è¯¥ DOM å…ƒç´ ã€‚
***
### è¡¨å•ç»‘å®š
***
å…·ä½“çœ‹[è¡¨å•ç»‘å®š](https://cn.vuejs.org/guide/essentials/forms)ã€‚
***
### ä¾¦å¬å™¨
***
ç”¨äºåœ¨æ•°æ®å˜åŒ–æ—¶ï¼Œæ‰§è¡Œéè®¡ç®—æ€§å¤æ‚ä»»åŠ¡ï¼ˆå‘é€è¯·æ±‚ï¼Œæ›´æ”¹DOMï¼‰ã€‚

    // å¯ä»¥ç›´æ¥ä¾¦å¬ä¸€ä¸ª ref
    watch(question, async (newQuestion, oldQuestion) => {
    if (newQuestion.includes('?')) {
    loading.value = true
    answer.value = 'Thinking...'
    try {
    const res = await fetch('https://yesno.wtf/api')
    answer.value = (await res.json()).answer
    } catch (error) {
    answer.value = 'Error! Could not reach the API. ' + error
    } finally {
    loading.value = false
    }
    }
    })

watchçš„ç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥æ˜¯ä¸€ä¸ªref(åŒ…æ‹¬è®¡ç®—å±æ€§)ï¼Œä¸€ä¸ªå“åº”å¼å¯¹è±¡ï¼ˆreactiveï¼‰ï¼Œä¸€ä¸ªgetterå‡½æ•°ï¼Œæˆ–å¤šä¸ªæ•°æ®æºç»„æˆçš„æ•°ç»„

    const x = ref(0)
    const y = ref(0)
    
    // å•ä¸ª ref
    watch(x, (newX) => {
    console.log(`x is ${newX}`)
    })
    
    // getter å‡½æ•°
    watch(
    () => x.value + y.value,
    (sum) => {
    console.log(`sum of x + y is: ${sum}`)
    }
    )
    
    // å¤šä¸ªæ¥æºç»„æˆçš„æ•°ç»„
    watch([x, () => y.value], ([newX, newY]) => {
    console.log(`x is ${newX} and y is ${newY}`)
    })

ä¸èƒ½ç›´æ¥ä¾¦å¬å“åº”å¼å¯¹è±¡çš„å±æ€§å€¼

    const obj = reactive({ count: 0 })
    // é”™è¯¯ï¼Œå› ä¸º watch() å¾—åˆ°çš„å‚æ•°æ˜¯ä¸€ä¸ª number
    watch(obj.count, (count) => {
    console.log(`Count is: ${count}`)
    })

ç›´æ¥ç»™ watch() ä¼ å…¥ä¸€ä¸ªå“åº”å¼å¯¹è±¡ï¼Œä¼šéšå¼åœ°åˆ›å»ºä¸€ä¸ªæ·±å±‚ä¾¦å¬å™¨â€”â€”è¯¥å›è°ƒå‡½æ•°åœ¨æ‰€æœ‰åµŒå¥—çš„å˜æ›´æ—¶éƒ½ä¼šè¢«è§¦å‘

    const obj = reactive({ count: 0 })
    
    watch(obj, (newValue, oldValue) => {
    // åœ¨åµŒå¥—çš„å±æ€§å˜æ›´æ—¶è§¦å‘
    // æ³¨æ„ï¼š`newValue` æ­¤å¤„å’Œ `oldValue` æ˜¯ç›¸ç­‰çš„
    // å› ä¸ºå®ƒä»¬æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼
    })
    
    obj.count++

***å³æ—¶å›è°ƒ***çš„ä¾¦å¬å™¨ï¼Œå³ç«‹å³æ‰§è¡Œä¸€éå›è°ƒã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œæˆ‘ä»¬æƒ³è¯·æ±‚ä¸€äº›åˆå§‹æ•°æ®ï¼Œç„¶ååœ¨ç›¸å…³çŠ¶æ€æ›´æ”¹æ—¶é‡æ–°è¯·æ±‚æ•°æ®ã€‚

    watch(
    source,
    (newValue, oldValue) => {
    // ç«‹å³æ‰§è¡Œï¼Œä¸”å½“ `source` æ”¹å˜æ—¶å†æ¬¡æ‰§è¡Œ
    },
    { immediate: true }
    )

***ä¸€æ¬¡æ€§***ä¾¦å¬å™¨ï¼šå›è°ƒåªåœ¨æºå˜åŒ–æ—¶è§¦å‘ä¸€æ¬¡

    watch(
    source,
    (newValue, oldValue) => {
    // å½“ `source` å˜åŒ–æ—¶ï¼Œä»…è§¦å‘ä¸€æ¬¡
    },
    { once: true }
    )

***watchEffect***ï¼š

ä½ æƒ³ç®€åŒ–ä»£ç ï¼Œè‡ªåŠ¨æ”¶é›†ä¾èµ–

ä½ éœ€è¦åœ¨åˆå§‹åŒ–æ—¶ç«‹å³æ‰§è¡Œä¸€æ¬¡

ä½ çš„å›è°ƒä¾èµ–å¤šä¸ªå“åº”å¼çŠ¶æ€ï¼Œä½†ä½ ä¸å…³å¿ƒå…·ä½“æ˜¯å“ªä¸ªå˜åŒ–è§¦å‘çš„

    watchEffect(() => {
    console.log(`count is ${count.value} and another is ${anotherRef.value}`)
    // ä¼šè‡ªåŠ¨è¿½è¸ª count.value å’Œ anotherRef.value ä½œä¸ºä¾èµ–
    })

***å¼‚æ­¥å¤„ç†æ—¶***çš„ä¾¦å¬ï¼š
è‹¥éœ€è¦çš„å“åº”å¼æ“ä½œåŒ…æ‹¬æœ‰å¼‚æ­¥è¯·æ±‚æ—¶ï¼Œä¼šå‡ºç°ä¸€ä¸‹æƒ…å†µï¼šå¼‚æ­¥è¯·æ±‚ç»“æœè¿˜æœªå®Œæˆï¼Œå³ä¸Šä¸€ä¸ªå˜åŒ–æ‰€è§¦å‘çš„å›è°ƒè¿˜æœªå®Œæˆæ—¶ï¼Œä¸‹ä¸€ä¸ªå˜åŒ–å·²ç»å‘ç”Ÿã€‚æ­¤æ—¶è¡¨æ˜ä¸Šä¸€ä¸ªå›è°ƒçš„ç»“æœå…¶å®å·²ç»å¤±æ•ˆäº†ï¼Œæ‰€ä»¥å¸Œæœ›èƒ½å¤Ÿå–æ¶ˆè¿‡æ—¶çš„è¯·æ±‚ã€‚

å¯ä»¥ä½¿ç”¨***onWatcherCleanup***æ¥æ³¨å†Œæ¸…ç†å‡½æ•°ã€‚

    import { watch, onWatcherCleanup } from 'vue'
    
    watch(id, (newId) => {
    const controller = new AbortController()
    
    fetch(`/api/${newId}`, { signal: controller.signal }).then(() => {
    // å›è°ƒé€»è¾‘
    })
    
    onWatcherCleanup(() => {
    // ç»ˆæ­¢è¿‡æœŸè¯·æ±‚
    controller.abort()
    })
    })

è¯·æ³¨æ„ï¼ŒonWatcherCleanup ä»…åœ¨ ***Vue 3.5+*** ä¸­æ”¯æŒï¼Œå¹¶ä¸”å¿…é¡»åœ¨ watchEffect æ•ˆæœå‡½æ•°æˆ– watch å›è°ƒå‡½æ•°çš„***åŒæ­¥æ‰§è¡ŒæœŸé—´***è°ƒç”¨ï¼šä½ ä¸èƒ½åœ¨å¼‚æ­¥å‡½æ•°çš„ await è¯­å¥ä¹‹åè°ƒç”¨å®ƒã€‚

3.5ä¹‹å‰ï¼ŒonCleanup å‡½æ•°è¿˜ä½œä¸º***ç¬¬ä¸‰ä¸ªå‚æ•°***ä¼ é€’ç»™ä¾¦å¬å™¨å›è°ƒï¼Œä»¥åŠ watchEffect ä½œç”¨å‡½æ•°çš„***ç¬¬ä¸€ä¸ªå‚æ•°***ï¼š
    
    watch(id, (newId, oldId, onCleanup) => {
    // ...
    onCleanup(() => {
    // æ¸…ç†é€»è¾‘
    })
    })
    
    watchEffect((onCleanup) => {
    // ...
    onCleanup(() => {
    // æ¸…ç†é€»è¾‘
    })
    })
æ­¤å¤–ï¼Œé€šè¿‡å‡½æ•°å‚æ•°ä¼ é€’çš„ onCleanup ä¸ä¾¦å¬å™¨å®ä¾‹ç›¸ç»‘å®šï¼Œå› æ­¤ä¸å— onWatcherCleanup çš„åŒæ­¥é™åˆ¶ã€‚

***å›è°ƒçš„è§¦å‘æ—¶æœº***ï¼š

é»˜è®¤æƒ…å†µä¸‹ï¼Œä¾¦å¬å™¨å›è°ƒä¼šåœ¨***çˆ¶ç»„ä»¶æ›´æ–° (å¦‚æœ‰) ä¹‹åã€æ‰€å±ç»„ä»¶çš„ DOM æ›´æ–°ä¹‹å‰***è¢«è°ƒç”¨ã€‚è¿™æ„å‘³ç€å¦‚æœä½ å°è¯•åœ¨ä¾¦å¬å™¨å›è°ƒä¸­è®¿é—®æ‰€å±ç»„ä»¶çš„ DOMï¼Œé‚£ä¹ˆ DOM å°†å¤„äºæ›´æ–°å‰çš„çŠ¶æ€ã€‚
å¦‚æœæƒ³åœ¨ä¾¦å¬å™¨å›è°ƒä¸­èƒ½è®¿é—®è¢« ***Vue æ›´æ–°ä¹‹å***çš„æ‰€å±ç»„ä»¶çš„ DOMï¼Œä½ éœ€è¦æŒ‡æ˜ flush: 'post' é€‰é¡¹ï¼š

    watch(source, callback, {
    flush: 'post'
    })
    
    watchEffect(callback, {
    flush: 'post'
    })

åç½®åˆ·æ–°çš„ watchEffect() æœ‰ä¸ªæ›´æ–¹ä¾¿çš„åˆ«å***watchPostEffect()***ï¼š

    import { watchPostEffect } from 'vue'
    
    watchPostEffect(() => {
    /* åœ¨ Vue æ›´æ–°åæ‰§è¡Œ */
    })
***åŒæ­¥ä¾¦å¬å™¨***ï¼šå®ƒä¼šåœ¨ Vue è¿›è¡Œä»»ä½•æ›´æ–°ä¹‹å‰è§¦å‘

    watch(source, callback, {
    flush: 'sync'
    })
    
    watchEffect(callback, {
    flush: 'sync'
    })
åŒæ­¥è§¦å‘çš„ watchEffect() æœ‰ä¸ªæ›´æ–¹ä¾¿çš„åˆ«å***watchSyncEffect()***ï¼š

    import { watchSyncEffect } from 'vue'
    
    watchSyncEffect(() => {
    /* åœ¨å“åº”å¼æ•°æ®å˜åŒ–æ—¶åŒæ­¥æ‰§è¡Œ */
    })
åœ¨`setup()`æˆ– `<script setup>`ä¸­ç”¨åŒæ­¥è¯­å¥åˆ›å»ºçš„ä¾¦å¬å™¨ï¼Œä¼šè‡ªåŠ¨ç»‘å®šåˆ°å®¿ä¸»ç»„ä»¶å®ä¾‹ä¸Šï¼Œå¹¶ä¸”ä¼šåœ¨***å®¿ä¸»ç»„ä»¶å¸è½½æ—¶è‡ªåŠ¨åœæ­¢***ã€‚å› æ­¤ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½ æ— éœ€å…³å¿ƒæ€ä¹ˆåœæ­¢ä¸€ä¸ªä¾¦å¬å™¨ã€‚
ä¸€ä¸ªå…³é”®ç‚¹æ˜¯ï¼Œ***ä¾¦å¬å™¨å¿…é¡»ç”¨åŒæ­¥è¯­***ã€‚å¦‚æœç”¨***å¼‚æ­¥å›è°ƒ***åˆ›å»ºä¸€ä¸ªä¾¦å¬å™¨ï¼Œé‚£ä¹ˆå®ƒä¸ä¼šç»‘å®šåˆ°å½“å‰ç»„ä»¶ä¸Šï¼Œä½ å¿…é¡»æ‰‹åŠ¨åœæ­¢å®ƒï¼Œä»¥é˜²å†…å­˜æ³„æ¼ã€‚

    <script setup>
    import { watchEffect } from 'vue'
    
    // å®ƒä¼šè‡ªåŠ¨åœæ­¢
    watchEffect(() => {})
    
    // ...è¿™ä¸ªåˆ™ä¸ä¼šï¼
    setTimeout(() => {
      watchEffect(() => {})
    }, 100)
    </script>

è¦æ‰‹åŠ¨åœæ­¢ä¸€ä¸ªä¾¦å¬å™¨ï¼Œè¯·è°ƒç”¨***watch æˆ– watchEffect*** è¿”å›çš„å‡½æ•°ï¼š 

    const unwatch = watchEffect(() => {})
    // ...å½“è¯¥ä¾¦å¬å™¨ä¸å†éœ€è¦æ—¶
    unwatch()
***
### DOMå¼•ç”¨
***
ç›´æ¥è®¿é—®åº•å±‚ DOM å…ƒç´ ã€‚è¦å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç‰¹æ®Šçš„ ref attributeã€‚

    <input ref="input">

è¦åœ¨ç»„åˆå¼ API ä¸­è·å–å¼•ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¾…åŠ©å‡½æ•° useTemplateRef()[^>3.5]ï¼š

    <script setup>
    import { useTemplateRef, onMounted } from 'vue'
    
    // ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»ä¸æ¨¡æ¿ä¸­çš„ ref å€¼åŒ¹é…
    const input = useTemplateRef('my-input')
    
    onMounted(() => {
      input.value.focus()
    })
    </script>
    
    <template>
      <input ref="my-input" />
    </template>

***åœ¨3.5ä¹‹å‰***,æˆ‘ä»¬éœ€è¦å£°æ˜ä¸€ä¸ªä¸æ¨¡æ¿é‡Œ ref attribute åŒ¹é…çš„å¼•ç”¨ï¼š

    <script setup>
    import { ref, onMounted } from 'vue'
    
    // å£°æ˜ä¸€ä¸ª ref æ¥å­˜æ”¾è¯¥å…ƒç´ çš„å¼•ç”¨
    // å¿…é¡»å’Œæ¨¡æ¿é‡Œçš„ ref åŒå
    const input = ref(null)
    
    onMounted(() => {
      input.value.focus()
    })
    </script>
    
    <template>
      <input ref="input" />
    </template>

***ç»„ä»¶ä¹Ÿèƒ½è¢«å¼•ç”¨***ã€‚
***
### ç»„ä»¶åŸºç¡€
***
é€šè¿‡`<script setup>`ï¼Œå¯¼å…¥çš„ç»„ä»¶éƒ½åœ¨æ¨¡æ¿ä¸­ç›´æ¥å¯ç”¨ã€‚

***ä¼ é€’props***

    defineProps(['title'])
ä¸€ä¸ªç»„ä»¶å¯ä»¥æœ‰***ä»»æ„å¤š***çš„ propsï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ prop éƒ½æ¥å—***ä»»æ„ç±»å‹çš„å€¼***ã€‚

***ç›‘å¬äº‹ä»¶***
å°†å­ç»„ä»¶çš„äº‹ä»¶ä¼ é€’åˆ°çˆ¶ç»„ä»¶è¿›è¡Œå¤„ç†ã€‚

    <!-- å­ç»„ä»¶.vue -->
    <script setup>
    defineEmits(['event'])
    </script>
    <template>
      <div class="blog-post">
        <h4>{{ title }}</h4>
        <button @click="$emit('event')">Enlarge text</button>
      </div>
    </template>
    
    <!-- çˆ¶ç»„ä»¶.vue-->
    <template>
    <å­ç»„ä»¶
      ...
      @event="handleMethod"
     />
    </template>

***æ’æ§½***

    <!-- å­ç»„ä»¶.vue -->
    <template>
      <div class="blog-post">
        <slot/>
      </div>
    </template>

***åŠ¨æ€ç»„ä»¶***
ç”¨`<component :is='...'>`å®ç°ï¼Œè¢«ä¼ ç»™ :is çš„å€¼å¯ä»¥æ˜¯ä»¥ä¸‹å‡ ç§ï¼š

- è¢«æ³¨å†Œçš„ç»„ä»¶å
- å¯¼å…¥çš„ç»„ä»¶å¯¹è±¡
***
### ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ
***
![ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ](../assets/VUE3-component-life-period.png)
***å¸¸ç”¨é’©å­å‡½æ•°***
- onmounted()
- onupdated()
- onunmounted()
***

### æ·±å…¥ç»„ä»¶
***
***ç»„ä»¶ä¸Šçš„v-model***
å®ç°å­ç»„ä»¶ä¸Šçš„åŒå‘ç»‘å®šï¼Œå¯ä»¥ç”¨defineModelæ¥å®ç°[^>3.4]ã€‚

    <MyComponent
    v-model:first-name="first"
    v-model:last-name="last"
    />
    
    <!-- MyComponent.vue -->
    <script setup>
        const firstName = defineModel('firstName')
        const lastName = defineModel('lastName')
    </script>
    
    <template>
      <input type="text" v-model="firstName" />
      <input type="text" v-model="lastName" />
    </template>

å¦‚æœéœ€è¦é¢å¤–çš„propé€‰é¡¹ï¼Œåº”è¯¥åœ¨modelåç§°ä¹‹åä¼ é€’ã€‚`const title = defineModel('title', { required: true })`
***

***é€ä¼ Attribute***
***
ä¹Ÿç§°fall-through attribute,å³å‘ä¸‹å è½çš„å±æ€§ã€‚å…·ä½“æŒ‡çš„æ˜¯çˆ¶ç»„ä»¶å‘å­ç»„ä»¶ä¼ å…¥ä½†æœªåœ¨å­ç»„ä»¶çš„***propsï¼Œemit***ä¸­å£°æ˜çš„å±æ€§æˆ–v-onäº‹ä»¶ã€‚
è‹¥å­ç»„ä»¶***åªæœ‰ä¸€ä¸ªæ ¹å…ƒç´ ***ï¼Œè¿™äº›å±æ€§æˆ–äº‹ä»¶ä¼šè‡ªåŠ¨ä¾é™„åœ¨æ ¹å…ƒç´ ä¸Šã€‚è‹¥æ ¹å…ƒç´ ä¹Ÿæ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œä¸”å­™ç»„ä»¶ä¸­ä¹Ÿä¸ºå£°æ˜è¯¥å±æ€§æˆ–äº‹ä»¶ï¼Œä¸”ä¹Ÿåªæœ‰ä¸€ä¸ªæ ¹å…ƒç´ ï¼Œåˆ™è¯¥å±æ€§æˆ–äº‹ä»¶ä¹Ÿè¿˜æ˜¯ä¼šä¸‹å åˆ°å­™ç»„ä»¶çš„æ ¹å…ƒç´ ä¸Šã€‚

è‹¥å­å­™ç»„ä»¶çš„æ ¹å…ƒç´ çš„å¯¹åº”å±æ€§æˆ–äº‹ä»¶æœ‰å€¼ï¼Œåˆ™ä¼šåˆå¹¶é€ä¼ å±æ€§æˆ–äº‹ä»¶çš„å€¼ã€‚

å¯ä»¥ç¦ç”¨è¿™ç§ä¸‹æ²‰ï¼š

    <script setup>
    defineOptions({
      inheritAttrs: false
    })
    // ...setup é€»è¾‘
    </script>

å±æ€§ä¸äº‹ä»¶åœ¨æ¨¡æ¿çš„è¡¨è¾¾å¼ä¸­ç›´æ¥ç”¨`$attrs`è®¿é—®åˆ°ã€‚å¦‚ï¼š`<span>Fallthrough attribute: {{ $attrs['attribute-name'] }}</span> `ï¼Œ`<button @click=$sttrs.onClick/>`ã€‚å…¶ä¸­åŒ…å«çš„å‡ºpropsä¸emitä¸­å£°æ˜çš„å‚æ•°ä¸äº‹ä»¶ä¹‹å¤–çš„å‚æ•°
ä¸äº‹ä»¶ã€‚

åœ¨ç¦ç”¨äº†è‡ªåŠ¨ä¸‹æ²‰ä¹‹åï¼Œå¯ä»¥åœ¨å­ç»„ä»¶ä¸­çš„éæ ¹å…ƒç´ ä¸­ä½¿ç”¨æ˜¾ç¤ºç»‘å®šæ¥ç»‘å®šä¼ å…¥å‚æ•°æˆ–äº‹ä»¶ï¼š
` <button class="btn" v-bind="$attrs">Click Me</button>`
æ²¡æœ‰å‚æ•°çš„ v-bind ä¼šå°†ä¸€ä¸ªå¯¹è±¡çš„***æ‰€æœ‰å±æ€§***éƒ½ä½œä¸º attribute åº”ç”¨åˆ°ç›®æ ‡å…ƒç´ ä¸Šã€‚

å’Œå•æ ¹èŠ‚ç‚¹ç»„ä»¶æœ‰æ‰€ä¸åŒï¼Œ***æœ‰ç€å¤šä¸ªæ ¹èŠ‚ç‚¹***çš„ç»„ä»¶æ²¡æœ‰è‡ªåŠ¨ attribute é€ä¼ è¡Œä¸ºã€‚å¦‚æœ $attrs æ²¡æœ‰è¢«æ˜¾å¼ç»‘å®šï¼Œå°†ä¼šæŠ›å‡ºä¸€ä¸ªè¿è¡Œæ—¶è­¦å‘Šã€‚

å¯ä»¥åœ¨ &lt;script setup> ä¸­ä½¿ç”¨ ***useAttrs()*** API æ¥è®¿é—®ä¸€ä¸ªç»„ä»¶çš„æ‰€æœ‰é€ä¼  attributeï¼š

    <script setup>
    import { useAttrs } from 'vue'
    
    const attrs = useAttrs()
    </script>
***
***æ’æ§½è¿›é˜¶***
***
é™¤äº†ç®€å•ä½¿ç”¨å¤–ï¼Œè¿˜èƒ½è¿›è¡Œè¿›è¡Œåˆ©ç”¨æ’æ§½è¿›è¡Œä¸€äº›ç‰¹æ®Šçš„æ“ä½œ

- æ’æ§½å†…å®¹å¯ä»¥æ˜¯ä»»æ„åˆæ³•çš„æ¨¡æ¿å†…å®¹ï¼Œä¸å±€é™äºæ–‡æœ¬ã€‚ä¾‹å¦‚æˆ‘ä»¬å¯ä»¥ä¼ å…¥å¤šä¸ªå…ƒç´ ï¼Œç”šè‡³æ˜¯ç»„ä»¶ã€‚

      <FancyButton><!-- FancyButtonæ˜¯ä¸€ä¸ªå­ç»„ä»¶ -->
      <span style="color:red">Click me!</span>
      <AwesomeIcon name="plus" />
      </FancyButton>
- æ’æ§½å†…å®¹å¯ä»¥è®¿é—®æ’æ§½è¾“å…¥ç»„ä»¶ï¼ˆçˆ¶ç»„ä»¶ï¼‰çš„æ•°æ®ï¼Œä¸èƒ½å½“é—®æ’æ§½è¾“å‡ºç»„ä»¶ï¼ˆå­ç»„ä»¶ï¼‰çš„æ•°æ®ã€‚


- é»˜è®¤å†…å®¹


    <button type="submit">
      <slot>
        Submit <!-- é»˜è®¤å†…å®¹ -->
      </slot>
    </button>
- å…·åæ’æ§½
æœ‰æ—¶å­ç»„ä»¶ä¸­æœ‰å¤šä¸ªæ’æ§½ï¼Œæ­¤æ—¶éœ€è¦ä¸ºæ¯ä¸ªæ’æ§½å‘½ååŠ ä»¥åŒºåˆ†ï¼Œæœªå‘½åçš„æ’æ§½é»˜è®¤åä¸º***default***ã€‚


    <div class="container">
      <header>
        <slot name="header"></slot>
      </header>
      <main>
        <slot></slot>
      </main>
      <footer>
        <slot name="footer"></slot>
      </footer>
    </div>

çˆ¶ç»„ä»¶åœ¨è¿›è¡Œä¼ å…¥æ—¶ï¼š


    <BaseLayout>
      <template #header>
        <h1>Here might be a page title</h1>
      </template>
    
    <template #default>
    <p>A paragraph for the main content.</p>
    <p>And another one.</p>
    </template>
    
    <template #footer>
    <p>Here's some contact info</p>
    </template>
    </BaseLayout>
- æ¡ä»¶æ’æ§½

æœ‰æ—¶éœ€è¦æ ¹æ®***å†…å®¹æ˜¯å¦è¢«ä¼ å…¥äº†æ’æ§½***æ¥æ¸²æŸ“æŸäº›å†…å®¹ã€‚


    <template>
      <div class="card">
        <div v-if="$slots.header" class="card-header">
          <slot name="header" />
        </div>
    
        <div v-if="$slots.default" class="card-content">
          <slot />
        </div>
        
        <div v-if="$slots.footer" class="card-footer">
          <slot name="footer" />
        </div>
      </div>
    </template>

- ä½œç”¨åŸŸæ’æ§½
å®ç°æ’æ§½è®¿é—®å­ç»„ä»¶æ•°æ®æ•ˆæœ
- ä¾èµ–æ³¨å…¥

å®ç°è·¨å±‚æ•°æ®ä¼ é€’ï¼Œå½“ç¥–çˆ¶ç»„ä»¶æƒ³è¦ä¼ é€’æ•°æ®ç»™å­™å­ç»„ä»¶æ—¶ï¼Œå¦‚æœä½¿ç”¨propså±æ€§ï¼Œå¿…é¡»å…ˆå°†æ•°æ®ä¼ ç»™å­ç»„ä»¶ç„¶åå­ç»„ä»¶å†å°†æ•°æ®é€å±‚ä¼ é€’ä¸‹å»ï¼Œæ˜¾ç„¶è¿™æ ·æ¯”è¾ƒéº»çƒ¦ã€‚
å¯ä»¥ä½¿ç”¨***provide***å’Œ***inject***è§£å†³è¿™ä¸€propé€çº§ä¼ é€’é—®é¢˜ã€‚

åœ¨ç¥–å…ˆç»„ä»¶ä¸­æä¾›ä¼ é€’å‚æ•°ï¼š

    <script setup>
    import { provide } from 'vue'
    
    provide(/* æ³¨å…¥å */ 'message', /* å€¼ */ 'hello!')
    </script>

åœ¨å­å­™ç»“ç‚¹ä¸­æ³¨å…¥ä¼ é€’å‚æ•°ï¼š

    <script setup>
    import { inject } from 'vue'
    
    const message = inject('message')
    </script>

å¦‚æœæä¾›çš„å€¼æ˜¯ä¸€ä¸ª refï¼Œæ³¨å…¥è¿›æ¥çš„ä¼šæ˜¯è¯¥ ref å¯¹è±¡ï¼Œè€Œä¸ä¼šè‡ªåŠ¨è§£åŒ…ä¸ºå…¶å†…éƒ¨çš„å€¼ã€‚è¿™ä½¿å¾—æ³¨å…¥æ–¹ç»„ä»¶èƒ½å¤Ÿé€šè¿‡ ref å¯¹è±¡ä¿æŒäº†å’Œä¾›ç»™æ–¹çš„***å“åº”æ€§é“¾æ¥***ã€‚
å½“æä¾› / æ³¨å…¥å“åº”å¼çš„æ•°æ®æ—¶ï¼Œå»ºè®®å°½å¯èƒ½å°†ä»»ä½•å¯¹å“åº”å¼çŠ¶æ€çš„***å˜æ›´éƒ½ä¿æŒåœ¨ä¾›ç»™æ–¹ç»„ä»¶***ä¸­ã€‚

    <!-- åœ¨ä¾›ç»™æ–¹ç»„ä»¶å†… -->
    <script setup>
    import { provide, ref } from 'vue'
    
    const location = ref('North Pole')
    
    function updateLocation() {
      location.value = 'South Pole'
    }
    
    provide('location', {
      location,
      updateLocation
    })
    </script>

    <!-- åœ¨æ³¨å…¥æ–¹ç»„ä»¶ -->
    <script setup>
    import { inject } from 'vue'
    
    const { location, updateLocation } = inject('location')
    </script>
    
    <template>
      <button @click="updateLocation">{{ location }}</button>
    </template>



æƒ³ç¡®ä¿æä¾›çš„æ•°æ®ä¸èƒ½è¢«æ³¨å…¥æ–¹çš„ç»„ä»¶æ›´æ”¹ï¼Œä½ å¯ä»¥ä½¿ç”¨ readonly() æ¥åŒ…è£…æä¾›çš„å€¼ã€‚


    <script setup>
    import { ref, provide, readonly } from 'vue'
    
    const count = ref(0)
    provide('read-only-count', readonly(count))
    </script>
### è·¯ç”±
***
***è·¯ç”±ä¸åŠ¨æ€ç»„ä»¶çš„åŒºåˆ«***
åŠ¨æ€ç»„ä»¶é€šè¿‡äº‹ä»¶æœºåˆ¶å¯¹DOMè¿›è¡Œæ›´æ”¹ï¼Œå–æ¶ˆæŒ‚è½½æ—§ç»„ä»¶ï¼ŒæŒ‚è½½æ–°ç»„ä»¶ï¼Œä»è€Œå®ç°åˆ‡æ¢ã€‚
è·¯ç”±æ˜¯ç”±ç½‘å€çš„æ”¹å˜è€Œå®ç°çš„åˆ‡æ¢ã€‚

ç®€å•è·¯ç”±å¯ç”±***haschange***äº‹ä»¶ä¸***åŠ¨æ€ç»„ä»¶***å®ç°ã€‚

    <script setup>
    import { ref, computed } from 'vue'
    import Home from './Home.vue'
    import About from './About.vue'
    import NotFound from './NotFound.vue'
    const routes = {
      '/': Home,
      '/about': About
    }
    const currentPath = ref(window.location.hash)
    window.addEventListener('hashchange', () => {
      currentPath.value = window.location.hash
    })
    const currentView = computed(() => {
      return routes[currentPath.value.slice(1) || '/'] || NotFound
    })
    </script>
    <template>
      <a href="#/">Home</a> |
      <a href="#/about">About</a> |
      <a href="#/non-existent-path">Broken Link</a>
      <component :is="currentView" />
    </template>
***
***å¤æ‚è·¯ç”±ï¼šVue Routerç»„ä»¶***
***
***å¼•å…¥router***

    npm install vue-router@4 //å®‰è£…

    <!-- main.js-->
    import { createApp } from 'vue'
    import router from './router'
    import App from './app.vue'
    
    createApp(App)
    .use(router)
    .mount('#app')
    
    <!--./router.js -->
    import { createMemoryHistory, createRouter } from 'vue-router'
    
    import HomeView from './HomeView.vue'
    import AboutView from './AboutView.vue'
    
    const routes = [
    { path: '/', component: HomeView },
    { path: '/about', component: AboutView },
    ]
    
    const router = createRouter({
    history: createMemoryHistory(),
    routes,
    })
    
    export default router

    <!-- APP.vue-->
    <template>
      <h1>Hello App!</h1>
      <p>
        <strong>Current route path:</strong> {{ $route.fullPath }}
      </p>
      <nav>
        <RouterLink to="/">Go to Home</RouterLink>
        <RouterLink to="/about">Go to About</RouterLink>
      </nav>
      <main>
        <RouterView />
      </main>
    </template>
***$route.fullPath***å¯ç”¨äºè®¿é—®å½“å‰è·¯ç”±ã€‚

åœ¨router.jsä¸­ï¼š

- routeså®šä¹‰äº†ä¸€ç»„è·¯ç”±åˆ°ç»„ä»¶çš„æ˜ å°„ã€‚
- historyé€‰é¡¹æ§åˆ¶äº†è·¯ç”±å’Œ URL è·¯å¾„æ˜¯å¦‚ä½•åŒå‘æ˜ å°„çš„ã€‚ä¾‹å­ä¸­çš„***createMemoryHistory***è¡¨ç¤ºå®Œå…¨å¿½è§†æµè§ˆå™¨çš„URL
è€Œä½¿ç”¨è‡ªå·±å†…éƒ¨çš„URLã€‚

åœ¨main.jsä¸­å¼•å…¥router.jså¹¶è¿›è¡Œæ³¨å†Œã€‚

åœ¨ç»„ä»¶ä¸­ä½¿ç”¨routerè¿›è¡Œ***è·³è½¬***æ—¶éœ€è¦è®¿é—®routerï¼Œç»„åˆæ—¶APIçš„ä½¿ç”¨æ–¹æ³•ä¸ºï¼šä½¿ç”¨***useRouteã€useRouter***

    <script setup>
    import { computed } from 'vue'
    import { useRoute, useRouter } from 'vue-router'
    
    const router = useRouter()
    const route = useRoute()
    
    const search = computed({
      get() {
        return route.query.search ?? ''
      },
      set(search) {
        router.replace({ query: { search } })
      }
    })
    </script>
***

***åŠ¨æ€è·¯ç”±***
***
å°†å¤šä¸ªurlåŒ¹é…åˆ°ä¸€ä¸ªç»„ä»¶

    import User from './User.vue'
    
    // è¿™äº›éƒ½ä¼šä¼ é€’ç»™ `createRouter`
    const routes = [
    // åŠ¨æ€å­—æ®µä»¥å†’å·å¼€å§‹
    { path: '/users/:id', component: User },
    ]

    <template>
      <div>
        <!-- å½“å‰è·¯ç”±å¯ä»¥é€šè¿‡ $route åœ¨æ¨¡æ¿ä¸­è®¿é—® -->
        User {{ $route.params.id }}
      </div>
    </template>
åƒ /users/johnny å’Œ /users/jolyne è¿™æ ·çš„ URL éƒ½ä¼šæ˜ å°„åˆ°åŒä¸€ä¸ªè·¯ç”±ã€‚å½“ä¸€ä¸ªè·¯ç”±è¢«åŒ¹é…æ—¶ï¼Œå®ƒçš„***params***çš„å€¼å°†åœ¨æ¯ä¸ªç»„ä»¶ä¸­ä»¥***route.params***çš„å½¢å¼æš´éœ²å‡ºæ¥ã€‚
***è‹¥è®¾ç½®æœ‰å¤šä¸ªè·¯å¾„å‚æ•°***ï¼Œå®ƒä»¬ä¼šæ˜ å°„åˆ° $route.params ä¸Šçš„ç›¸åº”å­—æ®µã€‚å¦‚ï¼š

|åŒ¹é…æ¨¡å¼|åŒ¹é…è·¯å¾„|route.params|
|---|---|---|
|/users/:username|/users/eduardo|{ username: 'eduardo' }|
|/users/:username/posts/:postId	|/users/eduardo/posts/123	|{ username: 'eduardo', postId: '123' }|

route å¯¹è±¡è¿˜å…¬å¼€äº†***å…¶ä»–æœ‰ç”¨çš„ä¿¡æ¯***ï¼Œå¦‚ route.queryï¼ˆå¦‚æœ URL ä¸­å­˜åœ¨å‚æ•°ï¼‰ã€route.hash ç­‰ã€‚
***
***è·¯ç”±å˜åŒ–äº‹ä»¶***
***
ç”¨***watch*** æ¥ç›‘è§†è·¯ç”±å‚æ•°å®ç°å“åº”ï¼š

    watch(() => route.params.id, (newId, oldId) => {
    // å¯¹è·¯ç”±å˜åŒ–åšå‡ºå“åº”...
    })

å¸¸è§„å‚æ•°åªèƒ½ä¸åŒ¹é…urlçš„ç‰‡æ®µä¹‹é—´çš„å­—ç¬¦ä¸²ï¼Œå³/ä¹‹é—´çš„å­—ç¬¦ä¸²ã€‚è‹¥æƒ³åŒ¹é…ä»»æ„è·¯å¾„ï¼Œå¯åœ¨è·¯å¾„å‚æ•°åé¢çš„æ‹¬å·ä¸­åŠ å¦‚***æ­£åˆ™è¡¨è¾¾å¼***ã€‚

    const routes = [
    // å°†åŒ¹é…æ‰€æœ‰å†…å®¹å¹¶å°†å…¶æ”¾åœ¨ `route.params.pathMatch` ä¸‹
    { path: '/:pathMatch(.*)*', name: 'NotFound', component: NotFound },
    // å°†åŒ¹é…ä»¥ `/user-` å¼€å¤´çš„æ‰€æœ‰å†…å®¹ï¼Œå¹¶å°†å…¶æ”¾åœ¨ `route.params.afterUser` ä¸‹
    { path: '/user-:afterUser(.*)', component: UserGeneric },
    ]

***
***è·¯ç”±çš„åŒ¹é…è¯­æ³•***
***
è¦çœ‹çš„æ—¶å€™å»å¾€
[è·¯ç”±åŒ¹é…è¯­æ³•](https://router.vuejs.org/zh/guide/essentials/route-matching-syntax.html)ã€‚
***å‰©ä½™éƒ¨åˆ†è§å®˜ç½‘***
***



### çŠ¶æ€ç®¡ç†
#### ç®€å•çŠ¶æ€ç®¡ç†
***
æ„å»ºstore.jsæ¥ç®¡ç†çŠ¶æ€ã€‚

    // store.js
    import { reactive } from 'vue'
    
    export const store = reactive({
    count: 0,
    increment() {
    this.count++
    }
        })

    <!-- ComponentA.vue -->
    <script setup>
    import { store } from './store.js'
    </script>
    
    <template>From A: {{ store.count }}</template>

      <template>
      <button @click="store.increment()">
        From B: {{ store.count }}
      </button>
    </template>

é™¤äº†è¿™é‡Œç”¨åˆ°çš„å•ä¸ª***å“åº”å¼å¯¹è±¡***ä½œä¸ºä¸€ä¸ª store ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å…¶ä»–å“åº”å¼ API ä¾‹å¦‚ ***ref***æˆ–æ˜¯ ***computed***ï¼Œæˆ–æ˜¯ç”šè‡³é€šè¿‡ä¸€ä¸ª***ç»„åˆå¼å‡½æ•°***æ¥è¿”å›ä¸€ä¸ªå…¨å±€çŠ¶æ€
***
***å¤æ‚çŠ¶æ€æ’ä»¶ï¼špinia***
***
éœ€è¦æ—¶å‰å¾€[pinia](https://pinia.vuejs.org/zh/)
***


[^>3.5]:VUEç‰ˆæœ¬
[^>3.4]:VUEç‰ˆæœ¬
[^>3.3]:VUEç‰ˆæœ¬
[^>3.2]:VUEç‰ˆæœ¬
[^>3.1]:VUEç‰ˆæœ¬
